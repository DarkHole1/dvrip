#!/usr/bin/env python3

from socket     import AF_INET, SOCK_STREAM, socket as Socket
from sys        import argv
from test_dvrip import *

socket = Socket(AF_INET, SOCK_STREAM)
socket.connect((argv[1], 34567))
fp = socket.makefile('rwb')
req = ClientLogin(argv[2], argv[3])
for q in req.topackets(MockSession()):
	q.dump(fp)
fp.flush()
p = Packet.load(fp)
(n, rep), = req.acceptor().accept(p)
print(rep.result, SESSION.format(rep.session))

req2 = ClientLogout(argv[2], rep.session)
for q2 in req2.topackets(MockSession(session=rep.session, number=0xfaa)):
	q2.dump(fp)
fp.flush()
p2 = Packet.load(fp)
(n2, rep2), = req2.acceptor().accept(p2)
print(rep2.result, SESSION.format(rep2.session))
